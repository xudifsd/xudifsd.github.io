<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>JS的面向对象 | Xudifsd</title>
    <meta name="description" content="JS在很长一段时间内都被认为是没什么多大用处的语言，而且JS的程序员也不被重视，常常有类似于这样的程序员鄙视图，而且JS程序员总是处在被很多其他程序员鄙视的地位。但是原因主要是由于JS只能在浏览器中使用，出了浏览器JS什么也干不了。以前学《JavaScript语言精粹》看它介绍了很多复杂的面向对象的东西，我当时就...">

    <link rel="stylesheet" href="/blog/css/main.css">
    <link rel="canonical" href="https://xudifsd.org/blog/2012/04/js%e7%9a%84%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1/">
    <link rel="alternate" type="application/rss+xml" title="Xudifsd" href="https://xudifsd.org/blog/feed.xml">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/favicon/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="xudifsd"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/favicon/mstile-310x310.png" />


</head>

  <body>
    <header id="top">
    <div class="wrapper">
        <a href="/blog/" class="brand">Xudifsd</a>
        <small>Rational life</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/blog/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/blog/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>JS的面向对象</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2012-04-27
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>xudifsd
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/blog/category/#编程" title="Category: 编程" rel="category">编程</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/blog/tag/#JS" title="Tag: JS" rel="tag">JS</a>&nbsp;
    
        <a href="/blog/tag/#programming" title="Tag: programming" rel="tag">programming</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <p>JS在很长一段时间内都被认为是没什么多大用处的语言，而且JS的程序员也不被重视，常常有类似于<a href="http://huaban.com/pins/3677221/">这样</a>的程序员鄙视图，而且JS程序员总是处在被很多其他程序员鄙视的地位。但是原因主要是由于JS只能在浏览器中使用，出了浏览器JS什么也干不了。以前学《<a href="http://book.douban.com/subject/3590768/">JavaScript语言精粹</a>》看它介绍了很多复杂的面向对象的东西，我当时就觉得奇怪，为什么一个网页上的程序要这么复杂的技术，所以当时很多东西都直接跳过。但是现在有了<a href="http://nodejs.org/">Node</a>，它将JS从浏览器中解放了出来，并且用在了高性能的服务器端，这让JS有了很大的用途。所以重新复习了下《JavaScript语言精粹》，记一下笔记。</p>

<h2 id="js的面向对象">JS的面向对象</h2>

<p>JS支持面向对象，只是它的支持方法有些非主流，它使用“<a href="http://en.wikipedia.org/wiki/Prototype-based_programming">原型链</a>”来实现面向对象。只是原型链对于传统编程人员来说很难理解，但是一旦理解其实会发现这种轻量级的继承表现力很强。</p>

<p>JS有很好的对象的字面量表示，也正是因为JS的这种强大表示方法才有了<a href="http://json.org/">JSON</a>这种通用的数据交换格式。所以在JS中可以直接写出在其他语言需要“实例化”才能产生的对象。但是实际编程时，往往需要“未实例化”的对象的模板，也就是“类”，这样才能创造出许多相似但不同的“对象”。显然用JS对象的字面量来创造对象不能实现这一点，为了支持这一点，JS支持一种“伪类”，也就是原型链。</p>

<p>用下面的代码就可以创造出一个叫“Cat”的伪类，和一个叫“cat”的实例，且cat有个实例变量name。</p>

<pre>var Cat = function(name) {
	this.name = name;
};

var cat = new Cat("foo");</pre>

<p>这个语法和Java很像，但是这个例子并没有用到原型链，所以也就没有实现继承的。</p>

<p>下面的代码用原型链实现的继承：</p>

<pre>var Animal = function(sound) {
	this.sound = sound;
};

var Cat = function(name) {
	this.name = name;
};

Cat.prototype = new Animal("meow");	//实现继承
Cat.prototype.says = function() {
	return this.sound + ', ' + this.name;
};</pre>

<p>这里Cat伪类继承了Animal，通过原型链Cat子类可以访问在父类中定义的变量sound（通过this.sound访问）。但是这一段程序估计那些用正经类的人根本看不懂。下面进行一些解释：</p>

<h2 id="js中的函数有四种调用方法">JS中的函数有四种调用方法</h2>

<p>一般静态语言的程序调用函数非常简单，将参数传入，取得返回值就行。支持<a href="http://en.wikipedia.org/wiki/Closure_(computer_science)">闭包</a>的程序就更复杂一些了，由于函数可以动态定义，所以还需要考虑函数定义时的环境。JS也支持闭包，但是JS的函数调用更加复杂：不同的函数调用方法会影响this关键字指向什么东西。</p>

<p>JS的函数总共有四种调用方式：</p>

<ol>
  <li>方法调用模式</li>
  <li>函数调用模式</li>
  <li>构造器调用模式</li>
  <li>Apply调用模式</li>
</ol>

<p>这里只说构造器的调用模式。其他的可以看《JavaScript语言精粹》的4.3节。</p>

<p>面向对象的特点之一就是允许对象有自己的私有空间，对象外部必须通过对象才能引用对象的私有空间内容，而对象的方法也需要有个关键字来引用自己的私有空间，在JS中这个关键字就是this。前面说的四种调用方法就会影响this的绑定。</p>

<p>并且JS的函数的this是超级迟的绑定，声明了函数之后this是不一定绑定在哪，这样就允许JS中对函数的this进行高度地复用。在函数的构造器调用模式下this是绑定到一个新创建的对象，并且这个对象有一个隐藏连接到函数的prototype对象（注意，函数也是对象，它也有自己的属性）。构造器调用模式最后会返回这个新创建的对象。</p>

<h2 id="图解">图解</h2>

<p>一图胜千言：</p>

<pre>var father = {
	name: 'father'
};</pre>

<p>这里用JS对象的字面量直接声明一个对象，这时内存中的样子像这样：<br />
<a href="/blog/statics/2012/04/Selection_001.png"><img class="aligncenter size-full wp-image-150" title="内存中的状态" src="/blog/statics/2012/04/Selection_001.png" alt="" width="246" height="192" /></a></p>

<pre>var Child = function(name) {
	this.name = name;
};</pre>

<p>这里声明一个函数，由于JS支持闭包，所以这时在内存中函数还会有闭包属性，这个闭包包括了定义Child函数的环境的所有信息（在调用函数时会用到），但与其他语言不同的时JS的函数对象还有prototype属性，由于JS无法知道哪些函数是作为构造器来调用的，所以每个函数都会有这个属性，它指向一个有constructor属性的对象，并且该constructor指向函数本身：<br />
<a href="/blog/statics/2012/04/Selection_0025.png"><img class="aligncenter size-medium wp-image-162" title="内存中的状态" src="/blog/statics/2012/04/Selection_0025-300x134.png" alt="" width="300" height="134" srcset="/blog/statics/2012/04/Selection_0025-300x134.png 300w, /blog/statics/2012/04/Selection_0025.png 628w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>

<pre>Child.prototype = father;</pre>

<p>这里修改了Child的prototype属性，令它指向前面创建的father对象，这时如果修改了father.name属性，那么也会在Child.prototype.name中体现：<br />
<a href="/blog/statics/2012/04/Selection_0031.png"><img class="aligncenter size-medium wp-image-163" title="内存中的状态" src="/blog/statics/2012/04/Selection_0031-300x195.png" alt="" width="300" height="195" srcset="/blog/statics/2012/04/Selection_0031-300x195.png 300w, /blog/statics/2012/04/Selection_0031.png 422w" sizes="(max-width: 300px) 100vw, 300px" /></a><a href="/blog/statics/2012/04/Selection_0061.png"><br />
</a></p>

<pre>Child.prototype.get_name = function() {
	return this.name;
};</pre>

<p>给Child.prototype添加一个get_name属性，这个属性指向一个新创建的函数，该函数也有自己prototype和闭包属性，并且由于Child.prototype和father指向同一个对象，father也就有了get_name属性：<br />
<a href="/blog/statics/2012/04/Selection_0041.png"><img class="aligncenter size-medium wp-image-164" title="内存中的状态" src="/blog/statics/2012/04/Selection_0041-300x165.png" alt="" width="300" height="165" srcset="/blog/statics/2012/04/Selection_0041-300x165.png 300w, /blog/statics/2012/04/Selection_0041-670x370.png 670w, /blog/statics/2012/04/Selection_0041.png 678w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>

<pre>var mychild = new Child('foo');</pre>

<p>这里是整个原型链的关键，注意必须用new来调用Child函数，这样JS才知道Child是以构造器的方式来调用的，否则如果没有new那么JS就会以普通函数来调用，这样this就会错误地绑定到全局变量上去，造成全局变量中name被修改或者定义，而且mychild会变成undefined，这样会造成很难发现的bug。另一个值得注意的地方是mychild从此有了一个从Child.prototype继承下来的隐藏的prototype属性，这个属性无法通过mychild直接访问到，只是在访问未在mychild中定义而在father中定义的属性会用到（在这个例子中如果访问mychild.get_name也会得到想要的函数，并且由于get_name的this没有绑定到任何地方，所以如果用father.get_name调用，this会绑定father，如果用mychild.get_name调用则会绑定到mychild上）。但是如果访问mychild.name时会直接得到’foo’，因为JS读任何对象的属性都遵守这样的一个规则：如果对象本身没有该属性，就到对象的隐藏的原型链中去找，如果再没有再找对象原型的原型，直到搜到原型链底部或者找到。但是写或者删除对象的属性就不会涉及到原型链。</p>

<p><a href="/blog/statics/2012/04/Selection_0051.png"><img class="aligncenter size-medium wp-image-165" title="内存中的状态" src="/blog/statics/2012/04/Selection_0051-300x214.png" alt="" width="300" height="214" srcset="/blog/statics/2012/04/Selection_0051-300x214.png 300w, /blog/statics/2012/04/Selection_0051.png 702w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>

<pre>delete mychild.name;</pre>

<p>在里用delete语句将mychild的name属性删除，所以mychild没有了name属性，但是这种删除会让原型链中的内容暴露出来，这时如果访问mychild.name会得到’father’，避免这种情况的方法就是通过mychild.hasOwnProperty(‘name’)的返回值来确定mychild本身是否有该属性。如果执行了删除后再执行delete mychild.name并不会删除father.name，因为删除或者写属性不会涉及到原型链：<br />
<a href="/blog/statics/2012/04/Selection_0061.png"><img class="aligncenter size-medium wp-image-166" title="内存中的状态" src="/blog/statics/2012/04/Selection_0061-300x215.png" alt="" width="300" height="215" srcset="/blog/statics/2012/04/Selection_0061-300x215.png 300w, /blog/statics/2012/04/Selection_0061.png 691w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>

<h2 id="短处">短处</h2>

<p>这种伪类的继承方法本身很好，但是由于必须用new来调用函数，容易造成一些难以发现的bug，所以《JavaScript语言精粹》的作者并不推荐这种方法，他主张用函数的闭包来实现继承，闭包可以到<a href="/blog/2011/11/%e9%97%ad%e5%8c%85,%e8%af%8d%e6%b3%95%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%92%8clambda%e5%87%bd%e6%95%b0/">这里</a>看，虽然是用scheme语言做例子，但是原理都一样，在这里就不废话了。</p>

        </article>
        <hr>

        
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                        
                        <h2 id="similar_posts">Similar Posts</h2>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="/blog/2016/05/use-percentile-in-performance-stats/">Use percentile in performance stats
                            
                            </a>
                        </li>
                        
                        
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
            
                
                    
                
                    
                
            
                
                    
                
                    
                        
                        <li class="relatedPost">
                            <a href="/blog/2015/09/%e5%ad%90%e5%ba%8f%e5%88%97%e4%b8%ad%e7%9a%84%e6%bb%91%e5%8a%a8%e7%aa%97%e5%8f%a3/">子序列中的滑动窗口
                            
                            </a>
                        </li>
                        
                        
                    
                
            
        
        
            </ul>
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/blog/2012/04/pthread%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93/">pthread学习总结</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/blog/2012/06/%e5%85%ac%e6%ad%a3/">公正</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        
<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'https://xudifsd.org/blog//2012/04/js%e7%9a%84%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'https://xudifsd.org/blog//2012/04/js%e7%9a%84%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//xudifsd.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


    </div>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>


    <footer class="site-footer">

    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            Contact me at:     
            <a href="https://twitter.com/xudifsd" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a>     
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a> with modification.
            </span>
        </p>
    </div>
</footer>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src="/blog/js/main.js" charset="utf-8"></script>
    <script src="/blog/js/smooth-scroll.min.js" charset="utf-8"></script>

    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
  </body>
</html>
